<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabel Komentar dengan Formulir Input</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: #333;
            padding: 20px;
            text-align: center;
            background-image: url('https://e1.pxfuel.com/desktop-wallpaper/793/132/desktop-wallpaper-backgrounds-keren-png-8-background-keren.jpg'); /* Ganti dengan URL gambar latar belakang Anda */
            background-size: cover;
            background-position: center;
        }
        h2 {
            text-align: center;
            color: #08ff08;
        }
        form {
            max-width: 600px;
            margin: 0 auto 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            border: none;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        th, td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        @media (max-width: 600px) {
            form {
                flex-direction: column;
                gap: 5px;
            }
            input[type="text"], button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h2>Tabel Komentar</h2>
    <thead>
        <th>Made By : EDY</th>
    </thead>
    <!-- Formulir untuk memasukkan nama dan komentar -->
    <form id="commentForm">
        <input type="text" id="nama" placeholder="Nama" required>
        <input type="text" id="komentar" placeholder="Komentar" required>
        <button type="submit">Kirim</button>
    </form>

    <!-- Tabel untuk menampilkan data -->
    <table>
        <thead>
            <tr>
                <th>Nama</th>
                <th>Komentar</th>
                <th>Tanggal</th>
                <th>GPS</th>
            </tr>
        </thead>
        <tbody id="commentTableBody">
            <!-- Data akan ditambahkan di sini -->
        </tbody>
    </table>

    <script>
        // Fungsi untuk mendapatkan data dari Google Sheets
        async function fetchGoogleSheetData() {
            try {
                const response = await fetch('https://sheet.best/api/sheets/c173a5a9-6f20-46cd-a480-fc348dc0f0af');
                if (!response.ok) throw new Error('Gagal mengambil data dari Google Sheets');
                const data = await response.json();
                data.forEach(entry => {
                    const { Nama, Komentar, Tanggal } = entry;
                    fetchGeolocationData(Nama, Komentar, Tanggal);
                });
            } catch (error) {
                console.error('Error fetching Google Sheet data:', error);
                alert('Gagal mengambil data. Silakan coba lagi nanti.');
            }
        }

        // Fungsi untuk mendapatkan data geolokasi
        async function fetchGeolocationData(nama, komentar, tanggal) {
            try {
                const response = await fetch('https://api.ipgeolocation.io/ipgeo?apiKey=45236A15FEBA9B0D29FED9107D312834');
                if (!response.ok) throw new Error('Gagal mengambil data geolokasi');
                const data = await response.json();
                const gps = `${data.latitude}, ${data.longitude}`;
                addRow(nama, komentar, tanggal, gps);
            } catch (error) {
                console.error('Error fetching geolocation data:', error);
                addRow(nama, komentar, tanggal, 'GPS tidak tersedia');
            }
        }

        // Fungsi untuk menambahkan baris ke tabel
        function addRow(nama, komentar, tanggal, gps) {
            const tableBody = document.getElementById('commentTableBody');
            const newRow = tableBody.insertRow();
            
            const cellNama = newRow.insertCell(0);
            const cellKomentar = newRow.insertCell(1);
            const cellTanggal = newRow.insertCell(2);
            const cellGPS = newRow.insertCell(3);

            cellNama.textContent = nama;
            cellKomentar.textContent = komentar;
            cellTanggal.textContent = tanggal;
            cellGPS.textContent = gps;
        }

        // Fungsi untuk mengirim data ke Google Sheets
        async function postToGoogleSheet(nama, komentar) {
            const data = {
                Nama: nama,
                Komentar: komentar,
                Tanggal: new Date().toLocaleDateString() // Menggunakan tanggal saat ini
            };

            try {
                const response = await fetch('https://sheet.best/api/sheets/c173a5a9-6f20-46cd-a480-fc348dc0f0af', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error('Gagal mengirim data ke Google Sheets');
                // Jika berhasil, tambahkan data ke tabel dan tampilkan baris baru
                fetchGeolocationData(nama, komentar, data.Tanggal);
            } catch (error) {
                console.error('Error posting data to Google Sheet:', error);
                alert('Gagal mengirim data. Silakan coba lagi nanti.');
            }
        }

        // Event listener untuk form submit
        document.getElementById('commentForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Mencegah refresh halaman
            const nama = document.getElementById('nama').value;
            const komentar = document.getElementById('komentar').value;

            // Kirim data ke Google Sheets
            postToGoogleSheet(nama, komentar);

            // Reset form
            document.getElementById('commentForm').reset();
        });

        // Panggil fungsi untuk mendapatkan data dari Google Sheets saat halaman dimuat
        fetchGoogleSheetData();
    </script>
</body>
</html>
